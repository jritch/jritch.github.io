<!DOCTYPE html>
<html>
  <head>
    <!-- Load D3 from site -->
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" charset="utf-8"></script>
    <script src="./data.js" charset="utf-8"></script>
    <script src="./gapminder.js" charset="utf-8"></script>
    <script xmlns="http://www.w3.org/1999/xhtml" async="" src="https://cdn.rawgit.com/eligrey/Blob.js/0cef2746414269b16834878a8abc52eb9d53e6bd/Blob.js"></script>
    <script xmlns="http://www.w3.org/1999/xhtml" async="" src="https://cdn.rawgit.com/eligrey/FileSaver.js/e9d941381475b5df8b7d7691013401e171014e89/FileSaver.min.js"></script>
  </head>


  <link rel="stylesheet" type="text/css" href="main.css">

  <body id="thebody">

  <div id="container">
    <div id="xpcontainer">
        <h1 id="title_instructions"> Perception Experiment (Gapminder Data) </h1>

        <!--<h2 id="indicator_progress" text-align="center"> Progress: 1 / 54 trials</h2>-->
        <h1 id="year"> </h3>

        <h3 id="d3plot"> </h3>

        <div id="pressbar">
        <p> Press any key to animate.</p>
        </div>
    </div> <!-- xpcontainer -->

    <div id="end">
        <div id="span">
            <p> Congratulations! The experiment is over. </p>
            <br /> <br /> <br /> <br />
            <p>Please call the experimenter. </p>
        </div>
    </div>

    <div id="overlay">
        <div id="span">
            <p> Note that you can take a break between trials </p>
            <br /> <br /> <br /> <br />
            <p>Press &lt;Enter&gt; to continue </p>
        </div>
    </div>
    </div>

    <div id="controls">
        <h2>X Position</h1>
        <select id="select-x">
            <option value="fertility_rate">fertility_rate</option>
            <option value="population">population</option>
            <option value="life_expectancy" selected="selected">life_expectancy</option>
            <option value="">random</option>
          </select>
          <h2>Y Position</h2>
          <select id="select-y">
            <option value="fertility_rate" selected="selected">fertility_rate</option>
            <option value="population">population</option>
            <option value="life_expectancy">life_expectancy</option>
            <option value="">random</option>
          </select>
          <h2>Size</h2>
          <select id="select-s">
            <option value="fertility_rate">fertility_rate</option>
            <option value="population" selected="selected">population</option>
            <option value="life_expectancy">life_expectancy</option>
            <option value="">random</option>
          </select>
          <h2>Luminance</h2>
          <select id="select-l">
            <option value="fertility_rate">fertility_rate</option>
            <option value="population">population</option>
            <option value="life_expectancy">life_expectancy</option>
            <option value="" selected="selected">random</option>
          </select>

          <h2>Start Year</h2>
          <input type="text" id="year_0" value="1950"></input><br>
          <h2>End Year</h2>
          <input type="text" id="year_N" value="2016"></input>
          <br><br>

          <input id="play" class="button" type="button" value="Play"></input>
          <input id="reset" class="button" type="button" value="Reset"></input>
          <br><br>
          <div style="text-align: left; padding-left: 80px">
          <label><input type="checkbox" checked=true name="checkbox" value="Sub-Saharan Africa">Sub-Saharan Africa</label><br>
          <label><input type="checkbox" checked=true name="checkbox" value="Europe & Central Asia">Europe & Central Asia</label><br>

          <label><input type="checkbox" name="checkbox" value="East Asia & Pacific">East Asia & Pacific</label><br>
          <label><input type="checkbox" name="checkbox" value="Middle East & North Africa">Middle East & North Africa</label><br>

          <label><input type="checkbox" name="checkbox" value="America">America</label><br>
          <label><input type="checkbox" name="checkbox" value="South Asia">South Asia</label><br>
          </div>

    </div>

    <script type="text/javascript">
        function hide(idelement) {
            document.getElementById(idelement).style.display = "none";
        }
        function show(idelement) {
            document.getElementById(idelement).style.display = "block";
        }

        function update_mapping(e) {
            console.log(e)
            mapping[e.target.id.replace("select-","")] = e.target.value;
            d3.selectAll("svg").remove()
            data_series = generateData(gapminder,mapping)
            showData(data_series)
        }

        function regenerate() {

            // TODO: there was a bug while going from year 0 to year N if the process is interrupted
            year_0 = $("#year_0").val()-0
            year_N = $("#year_N").val()-0

            regions = []
            $("input[type=checkbox]:checked").each( function(key,value) {if (value.defaultValue){regions.push(value.defaultValue)}})


            d3.selectAll("svg").remove()
            data_series = generateData(gapminder,mapping)
            showData(data_series)
        }

        $("#year_0").on("change",regenerate)
        $("#year_N").on("change",regenerate)

        $("#reset").on("touchstart",regenerate)
        $("#reset").on("mousedown",regenerate)

        $("select").on("change",update_mapping)
        $("input[type=checkbox]").on("change",regenerate)

        hide("end")
        hide("overlay")

        data_series = generateData(gapminder,mapping)
        showData(data_series)


  </script>


  </body>
</html>
